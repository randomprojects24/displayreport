<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Team Data Card List</title>
    <!-- Load Tailwind CSS for utility styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif; /* Matching Liquid's font choice */
            background-color: #f0f4f8;
            min-height: 100vh;
            padding: 2rem;
        }
        .container {
            max-width: 700px;
            margin: auto;
        }
        /* Custom styles matching the Liquid template's dimensions and appearance */
        .team-card {
            width: 100%;
            height: 150px;
            background: black; /* Outer container color */
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        .logo-section {
            background: white;
            width: 70%;
            display: flex;
            align-items: center;
            padding: 10px;
        }
        .record-section {
            background: white;
            width: 30%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            border-left: 4px solid black;
            border-radius: 0 20px 20px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">NFL Team Snapshot</h1>
        
        <!-- Container where the dynamic cards will be inserted -->
        <div id="teamCardsList">
            <div id="loadingIndicator" class="p-6 bg-white rounded-xl shadow-md text-xl font-semibold text-gray-600 text-center">
                Fetching data for multiple teams...
            </div>
        </div>
    </div>

    <script>
        // Array of team IDs (equivalent to Liquid | split: ",")
        const teamIds = ["3", "8", "9", "16"]; 
        const API_BASE_URL = "https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams/";
        
        const teamCardsList = document.getElementById('teamCardsList');

        /**
         * Generates the HTML string for a single team card based on the API data.
         * @param {Object} teamData - The data object for a single team.
         * @returns {string} The HTML string for the card.
         */
        const generateTeamCardHTML = (teamData) => {
            const team = teamData.team;

            // Get logo (with fallback check)
            const logo = team.logos && team.logos[0] ? team.logos[0].href : 'https://placehold.co/110x110/333333/ffffff?text=LOGO';

            const name = team.displayName || 'Unknown Team';

            // Ensure recordSummary is a safe string, defaulting to '0-0-0'
            const recordSummary = team.record && team.record.items && team.record.items[0] 
                ? team.record.items[0].summary 
                : '0-0-0';

            // Split the record string and trim/default empty parts to '0'
            const recordSplit = recordSummary.split("-").map(s => s ? s.trim() : '0'); 
            
            // *** UPDATED LOGIC HERE ***
            // Use array destructuring with default values to ensure wins, losses, and ties 
            // are '0' if the split array contains fewer than 3 elements (e.g., if summary was "10-5").
            const [wins = '0', losses = '0', ties = '0'] = recordSplit;

            // Generate the card structure using a template literal
            return `
                <div class="team-card flex mb-6">
                    
                    <!-- Left: Logo + Name -->
                    <div class="logo-section">
                        <img src="${logo}" 
                             alt="${name} Logo" 
                             style="height:110px; margin-right:15px;"
                             onerror="this.onerror=null; this.src='https://placehold.co/110x110/333333/ffffff?text=LOGO';"
                        >

                        <div style="font-size:32px; font-weight:bold; line-height:1.1; text-transform:uppercase;">
                            ${name}
                        </div>
                    </div>

                    <!-- Right: W | L | T -->
                    <div class="record-section">
                        <span>${wins}</span>
                        <span style="margin:0 12px; color:#666; font-size:40px;">|</span>
                        <span>${losses}</span>
                        <span style="margin:0 12px; color:#666; font-size:40px;">|</span>
                        <span>${ties}</span>
                    </div>
                </div>
            `;
        };

        const fetchAndRenderTeams = async () => {
            const loadingIndicator = document.getElementById('loadingIndicator');

            // 1. Create an array of Promises for fetching data
            const fetchPromises = teamIds.map(id => {
                const apiURL = `${API_BASE_URL}${id}`; 
                return fetch(apiURL)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to fetch ID ${id}: ${response.status}`);
                        }
                        return response.json();
                    })
                    .catch(error => {
                        console.error(error);
                        return null;
                    });
            });

            try {
                // 2. Wait for all promises to resolve
                const results = await Promise.all(fetchPromises);
                
                // Remove loading indicator
                if (loadingIndicator) {
                    loadingIndicator.remove();
                }

                // 3. Process the successful results and generate HTML
                const cardHTML = results
                    .filter(data => data !== null) 
                    .map(generateTeamCardHTML)
                    .join(''); 

                // 4. Insert the combined HTML into the DOM
                teamCardsList.innerHTML = cardHTML;

            } catch (error) {
                console.error("Critical error during batch fetch:", error);
                
                // Show an error message instead of the cards
                teamCardsList.innerHTML = `
                    <div class="p-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg shadow-md mt-4">
                        <p class="font-bold">Error Loading Team List</p>
                        <p>There was a critical error fetching all required team data. Please check the network.</p>
                    </div>
                `;
            }
        };

        // Execute the function when the page is fully loaded
        document.addEventListener('DOMContentLoaded', fetchAndRenderTeams);
    </script>

</body>
</html>