<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chicago Bears Next Game Schedule</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f9; color: #333; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; background-color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 8px; }
        .team-display { display: flex; align-items: center; justify-content: space-around; }
        .team-info { flex: 1; }
        .team-info img { width: 300px; height: auto; }
        .team-info p { margin: 5px 0; }
        .bottomTitle { display: flex; align-items: center; justify-content: center; height: 30px; }
    </style>
</head>
<body>

<div class="container">
    <div id="game-container" class="game-info">
        <p class="loading">Fetching game schedule...</p>
    </div>
</div>

<script>
const API_URL = 'https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams/3';
const SCOREBOARD_URL = "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard";
const CONTAINER = document.getElementById('game-container');
const BEARS_ID = '3';

function getBestLogo(team) {
    if (team.logos && team.logos.length > 0) return team.logos[0].href;
    return "";
}

function getSecondaryLogo(team) {
    if (!team.logos) return "";
    const secondary = team.logos.find(l => l.rel && l.rel.includes("secondary_logo_on_white_color"));
    return secondary ? secondary.href : team.logos[1]?.href || team.logos[0]?.href || "";
}

async function fetchTeamRecord(teamId) {
    const response = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/teams/${teamId}`);
    const teamData = await response.json();
    return teamData?.team?.record?.items?.[0]?.summary || "Record Unavailable";
}

async function fetchLiveGameStatusAndScore(gameId) {
    const res = await fetch(SCOREBOARD_URL);
    const data = await res.json();
    const event = data.events.find(e => e.id === gameId);
    if (!event) return null;

    const comp = event.competitions[0];
    const teams = comp.competitors;

    const bears = teams.find(t => t.team.id === BEARS_ID);
    const opp = teams.find(t => t.team.id !== BEARS_ID);

    const bearsScore = parseInt(bears.score || 0);
    const oppScore = parseInt(opp.score || 0);

    let color = bearsScore > oppScore ? "green" : bearsScore < oppScore ? "red" : "orange";

    return {
        status: comp.status.type.shortDetail,
        bearsScore, oppScore, color
    };
}

async function fetchGameData() {
    const response = await fetch(API_URL);
    const data = await response.json();

    const bears = data.team;
    const bearsLogo = getBestLogo(bears);
    const bearsSecondaryLogo = getSecondaryLogo(bears);
    const bearsName = bears.displayName;

    const nextGame = data.team.nextEvent?.[0];
    if (!nextGame) return CONTAINER.innerHTML = "<p>No upcoming game.</p>";

    const comp = nextGame.competitions[0];
    const competitors = comp.competitors;
    const broadcasts = comp.broadcasts?.[0];

    const bearsComp = competitors.find(c => c.team.id === BEARS_ID);
    const opponentComp = competitors.find(c => c.team.id !== BEARS_ID);
    const opponentTeam = opponentComp.team;
    const opponentLogo = getBestLogo(opponentTeam);
    const opponentName = opponentTeam.displayName;

    const bearsRecord = await fetchTeamRecord(BEARS_ID);
    const opponentRecord = await fetchTeamRecord(opponentTeam.id);

    const gameDate = new Date(nextGame.date);
    const formattedDate = gameDate.toLocaleString('en-US', { weekday: 'long', month: 'long', day: 'numeric', hour: 'numeric', minute: '2-digit' });
    const now = new Date();
    const showScore = now >= gameDate;

    const isBearsHome = bearsComp.homeAway === "home";
    const homeTeamBlock = `
        <div class="team-info">
            <img src="${isBearsHome ? opponentLogo : bearsLogo}">
            <p style="font-size:2em;font-weight:bold;">${isBearsHome ? opponentName : bearsName}</p>
            <p style="color:#666;">${isBearsHome ? opponentRecord : bearsRecord}</p>
        </div>`;
    const awayTeamBlock = `
        <div class="team-info">
            <img src="${isBearsHome ? bearsLogo : opponentLogo}">
            <p style="font-size:2em;font-weight:bold;">${isBearsHome ? bearsName : opponentName}</p>
            <p style="color:#666;">${isBearsHome ? bearsRecord : opponentRecord}</p>
        </div>`;

    CONTAINER.innerHTML = `
        <div class="team-display">${homeTeamBlock}<div style="font-size:5em;font-weight:bold;">@</div>${awayTeamBlock}</div>
        ${showScore ? `<div id="live-score-block" style="font-size:2em;font-weight:bold;">Loading score...</div>`
                   : `<p style="font-size:2em;font-weight:bold;">${formattedDate}</p>`}
        <div style="background:#d3d3d3;">
            <span class="bottomTitle">
                <img src="https://static.www.nfl.com/image/upload/v1554321393/league/nvfr7ogywskqrfaiu38m.svg" style="height:30px;">
                Next Chicago Bears <img src="${bearsSecondaryLogo}" style="height:28px;margin-left:5px;margin-right:5px;"> Game on ${broadcasts?.media?.shortName || "TBA"}
            </span>
        </div>
    `;

    if (showScore) {
        const score = await fetchLiveGameStatusAndScore(nextGame.id);
        if (score) {
            document.getElementById("live-score-block").innerHTML = `
                <span style="color:${score.color};">
                    Chicago Bears ${score.bearsScore} - ${score.oppScore}
                </span>
                <div style="font-size:.7em;color:#555;">${score.status}</div>
            `;
        }
    }
}

fetchGameData();
//setInterval(fetchGameData, 3600000); // Auto-refresh every 30 sec
</script>

</body>
</html>

